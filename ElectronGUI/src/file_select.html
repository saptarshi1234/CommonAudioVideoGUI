<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Common Video Audio Connect</title>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container-fluid">
        <h1>Common Video Audio Connect</h1>
        <h3>File Selection</h3><br>

        <form>
            <label for="directorySelect" class="btn btn-outline-secondary">Select a directory</label>
            <input style="visibility:hidden" id="directorySelect" type="file" webkitdirectory onchange="handleFileSelect(event)">
            
            <label for="fileSelect" class="btn btn-outline-secondary"> Select multiple files</label>
            <input style="visibility:hidden" id="fileSelect" type="file" multiple onchange="handleFileSelect(event)">

            <div class="form-check">
                <label for="onlyHost" class="form-check-label">
                    <input class="form-check-input" type="checkbox" name="onlyHost" id="onlyHost">Restrict playback
                    access to host only!
                </label>
            </div>
            <div class="form-check">
                <label for="qr" class="form-check-label">
                    <input class="form-check-input" type="checkbox" name="qr" id="qr">Display QR
                </label>
            </div>
        </form>
        <br>
        <div id="selectedFiles" class="card">
            <div class="card-header">
                Selected Files
            </div>
            <ul id="listFiles" class="list-group list-group-flush">
                <li style="display: none;" id="ListItem" style="display: none;">
                    <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                    </div>
                </li>
            </ul>
        </div>
        <br>
        <button class="btn btn-secondary" id="back">
            < Back</button> <button class="btn btn-success" id="next">Next >
        </button>
    </div>


    <script>
        const allFiles = [];
        const handleFileSelect = (event) => {
            const files = event.target.files;
            Object.values(files).forEach((file) => {
                console.log(file);
                displayFileCard(file);
                allFiles.push(file.path);
            })
        }
        const displayFileCard = (file) => {
            const node = document.querySelector('#ListItem');
            const newLi = node.cloneNode(true);
            newLi.style.display = "block";

            newLi.firstElementChild.firstElementChild.innerText = file.name;
            newLi.firstElementChild.firstElementChild.nextElementSibling.innerText = file.path;

            document.querySelector('#listFiles').appendChild(newLi);
        }
        const {
            ipcRenderer
        } = require('electron');
        const nextButton = document.querySelector('#next');
        nextButton.addEventListener('click', (e) => {
            const data = {
                'files': allFiles,
                'onlyHost': document.querySelector('#onlyHost').checked,
                'qr': document.querySelector('#qr').checked
            }
            ipcRenderer.send('start_cli', data);
            ipcRenderer.send('switch_page', 'terminal.html');
        });
        const backButton = document.querySelector('#back');
        backButton.addEventListener('click', (e) => {
            ipcRenderer.send('switch_page', 'index.html')
        });
    </script>
</body>

</html>